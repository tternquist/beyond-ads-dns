# Unbound recursive DNS resolver for beyond-ads-dns upstream.
# Listens on port 5353; beyond-ads-dns forwards cache misses here.
#
# Flow: Client -> beyond-ads-dns (blocklist, cache) -> Unbound (recursive) -> root/TLD

server:
  interface: 0.0.0.0
  port: 5353
  do-ip4: yes
  do-ip6: yes
  do-udp: yes
  do-tcp: yes
  verbosity: 1

  # Root hints for recursive resolution (used by custom ECS build)
  root-hints: "/opt/unbound/etc/unbound/root.hints"

  # Allow only private networks (Docker and local)
  access-control: 127.0.0.0/8 allow
  access-control: 10.0.0.0/8 allow
  access-control: 172.16.0.0/12 allow
  access-control: 192.168.0.0/16 allow
  access-control: ::1/128 allow
  access-control: fd00::/8 allow

  # DNSSEC validation
  # edns-client-subnet: pass client subnet to authoritative servers (GeoDNS/CDN optimization)
  # Requires custom Unbound image (Dockerfile.unbound); mvance/unbound does not include ECS.
  module-config: "validator iterator edns-client-subnet"

  # Cache and performance
  msg-cache-size: 128m
  rrset-cache-size: 256m
  key-cache-size: 128m
  neg-cache-size: 64m

  # Prefetch popular domains
  prefetch: yes
  prefetch-key: yes

  # Hide identity
  hide-identity: yes
  hide-version: yes

  # Minimal responses
  minimal-responses: yes
