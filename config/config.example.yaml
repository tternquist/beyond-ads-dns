server:
  listen:
    - "0.0.0.0:53"
  protocols:
    - udp
    - tcp
  read_timeout: "5s"
  write_timeout: "5s"

# Resolver strategy: failover | load_balance | weighted (weighted uses response-time EWMA to prefer faster upstreams)
resolver_strategy: failover
# Upstreams: plain DNS (host:port), DoT (tls://host:port), or DoH (https://host/path)
upstreams:
  - name: cloudflare
    address: "1.1.1.1:53"
  - name: google
    address: "8.8.8.8:53"
  - name: quad9
    address: "9.9.9.9:53"
  # DoT (DNS over TLS) - encrypted upstream:
  # - name: cloudflare-dot
  #   address: "tls://1.1.1.1:853"
  # DoH (DNS over HTTPS) - encrypted upstream:
  # - name: cloudflare-doh
  #   address: "https://cloudflare-dns.com/dns-query"

blocklists:
  refresh_interval: "6h"
  sources:
    - name: hagezi-pro
      url: "https://raw.githubusercontent.com/hagezi/dns-blocklists/main/domains/pro.txt"
  allowlist: []
  denylist: []

# Local DNS records - returned without upstream lookup, work when internet is down
# local_records:
#   - name: "router.local"
#     type: "A"
#     value: "192.168.1.1"
#   - name: "nas.home"
#     type: "A"
#     value: "192.168.1.10"

cache:
  redis:
    address: "redis:6379"
    db: 0
    password: ""
  min_ttl: "300s"
  max_ttl: "1h"
  negative_ttl: "5m"
  # servfail_backoff: "60s"       # Back off before retrying after SERVFAIL (security/misconfig indicator)
  # respect_source_ttl: false      # When true, don't extend TTL with min_ttl (strict source TTL)
  refresh:
    enabled: true
    hit_window: "1m"
    hot_threshold: 20
    min_ttl: "30s"
    hot_ttl: "2m"
    serve_stale: true
    stale_ttl: "5m"
    lock_ttl: "10s"
    max_inflight: 50
    sweep_interval: "15s"
    sweep_window: "2m"
    batch_size: 200
    sweep_min_hits: 1
    sweep_hit_window: "168h"

response:
  blocked: "nxdomain"
  blocked_ttl: "1h"

request_log:
  enabled: false
  directory: "logs"
  filename_prefix: "dns-requests"
  # format: "text" (default) or "json" for structured logs with query_id, qname, outcome, latency
  format: "text"

query_store:
  enabled: true
  address: "http://clickhouse:8123"
  database: "beyond_ads"
  table: "dns_queries"
  username: "beyondads"
  password: "beyondads"
  flush_interval: "5s"
  batch_size: 500
  retention_days: 7  # Number of days to keep query analytics data
  sample_rate: 1.0   # Fraction of queries to record (0.0-1.0). 1.0 = all. Use <1.0 to reduce load at scale.

control:
  enabled: true
  listen: "0.0.0.0:8081"
  token: ""

# DoH/DoT server: accept encrypted DNS from clients (requires TLS certs)
# doh_dot_server:
#   enabled: true
#   cert_file: "/path/to/fullchain.pem"
#   key_file: "/path/to/privkey.pem"
#   dot_listen: "0.0.0.0:853"   # DoT (DNS over TLS)
#   doh_listen: "0.0.0.0:8443"  # DoH (DNS over HTTPS) - use 443 if not sharing with web UI
#   doh_path: "/dns-query"

# Multi-instance sync: one primary, any number of replicas
# Primary: replicas pull config via API tokens
# Replica: receives DNS-affecting config from primary; can tune cache/query store locally
# sync:
#   role: primary  # or replica
#   enabled: false
#   # Primary: list of tokens for replicas (id = token value, name = label)
#   tokens:
#     - id: "your-secret-token-here"
#       name: "Replica A"
#       created_at: "2025-02-13T12:00:00Z"
#       last_used: ""
#   # Replica only:
#   primary_url: "http://primary-host:8081"
#   sync_token: "your-secret-token-here"
#   sync_interval: "60s"

# Optional: Override the hostname displayed in the UI
# If not set, the system hostname will be used
ui:
  hostname: ""
